<script>
const navbar = document.querySelector(".navbar");
const content = document.querySelector(".content-wrapper");
const btn = document.getElementById("toggleBtn");

// ---------- STATE FUNCTIONS ----------
function setCollapsed(collapsed) {
  navbar.classList.toggle("collapsed", collapsed);
  content.classList.toggle("expanded", collapsed);
  btn.textContent = collapsed ? "✖" : "☰";
  localStorage.setItem("navbarState", collapsed ? "collapsed" : "expanded");
}

function toggleNavbar() {
  const isCollapsed = navbar.classList.contains("collapsed");
  setCollapsed(!isCollapsed);
}

// ---------- LOAD SAVED STATE ----------
const savedState = localStorage.getItem("navbarState");

// Auto-collapse on small screens
if (window.innerWidth <= 600) {
  setCollapsed(true);
} else if (savedState === "collapsed") {
  setCollapsed(true);
} else {
  setCollapsed(false);
}

// ---------- BUTTON CLICK ----------
btn.addEventListener("click", toggleNavbar);

// ---------- KEYBOARD SHORTCUT (M) ----------
document.addEventListener("keydown", (e) => {
  if (e.key.toLowerCase() === "m") {
    toggleNavbar();
  }
});

// ---------- SWIPE GESTURE ----------
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener("touchstart", (e) => {
  touchStartX = e.changedTouches[0].screenX;
});

document.addEventListener("touchend", (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});

function handleSwipe() {
  const swipeDistance = touchEndX - touchStartX;

  // swipe right = open
  if (swipeDistance > 80) {
    setCollapsed(false);
  }

  // swipe left = close
  if (swipeDistance < -80) {
    setCollapsed(true);
  }
}

// ---------- RESIZE HANDLER ----------
window.addEventListener("resize", () => {
  if (window.innerWidth <= 600) {
    setCollapsed(true);
  }
});
</script>
